syntax = "proto3";

package files;
option go_package = "./gen/filespb";

// ------------------------------
// File Metadata Model
// ------------------------------
message File {
  string id = 1;
  string owner_id = 2 [json_name = "ownerId"];
  string channel_id = 3 [json_name = "channelId"];     
  string filename = 4;
  int64 size = 5;
  string mime_type = 6 [json_name = "mimeType"];
  string storage_path = 7 [json_name = "storagePath"];
  bool is_public = 8 [json_name = "isPublic"];         
  string created_at = 9 [json_name = "createdAt"];
}

// ------------------------------
// REQUEST TO GET PRESIGNED URL FOR UPLOAD
// ------------------------------
message GenerateUploadURLRequest {
  string owner_id = 1 [json_name = "ownerId"];
  string channel_id = 2 [json_name = "channelId"];
  string filename = 3;
  int64 size = 4;
  string mime_type = 5 [json_name = "mimeType"];
  bool is_public = 6 [json_name = "isPublic"];
}

// RESPONSE CONTAINING URL + KEY
message GenerateUploadURLResponse {
  string upload_url = 1 [json_name = "uploadUrl"];
  string storage_path = 2 [json_name = "storagePath"];
  string file_id = 3 [json_name = "fileId"];
}

// ------------------------------
// CONFIRM UPLOAD AFTER CLIENT FINISHED PUT TO S3
// ------------------------------
message ConfirmUploadRequest {
  string file_id = 1 [json_name = "fileId"];
}

message ConfirmUploadResponse {
  File file = 1;
}

// ------------------------------
// GENERATE PRESIGNED URL FOR DOWNLOAD
// ------------------------------
message GenerateDownloadURLRequest {
  string file_id = 1 [json_name = "fileId"];
  string requester_id = 2 [json_name = "requesterId"];
  int64 expire_seconds = 3 [json_name = "expireSeconds"];
}

message GenerateDownloadURLResponse {
  string download_url = 1 [json_name = "downloadUrl"];
  int64 expire_seconds = 2 [json_name = "expireSeconds"];
}

// ------------------------------
// LIST FILES FOR USER OR CHANNEL
// ------------------------------
message FileListRequest {
  string requester_id = 1 [json_name = "requesterId"];
  string channel_id = 2 [json_name = "channelId"];
}

message FileListResponse {
  repeated File files = 1;
}

// ------------------------------
// DELETE FILE + METADATA
// ------------------------------
message DeleteFileRequest {
  string file_id = 1 [json_name = "fileId"];
  string requester_id = 2 [json_name = "requesterId"];
}

message DeleteFileResponse {
  string message = 1;
}

// ------------------------------
// FILE SERVICE RPC
// ------------------------------
service FileService {
  // Uploading
  rpc GenerateUploadURL (GenerateUploadURLRequest) returns (GenerateUploadURLResponse);
  rpc ConfirmUpload (ConfirmUploadRequest) returns (ConfirmUploadResponse);

  // Downloading
  rpc GenerateDownloadURL (GenerateDownloadURLRequest) returns (GenerateDownloadURLResponse);

  // Management 
  rpc ListFiles (FileListRequest) returns (FileListResponse);
  rpc DeleteFile (DeleteFileRequest) returns (DeleteFileResponse);
}
