syntax = "proto3";

package admin;

option go_package = "./gen/adminpb";

// =============================================================================
// SHARED MODELS
// =============================================================================

// Simplified User model for Dashboard display
message DashboardUserPreview {
  string user_id = 1;
  string username = 2;
  string email = 3;
  string joined_at = 4;
  string avatar_url = 5;
}

message PaginationRequest {
  int32 page = 1;
  int32 limit = 2;
}

message PaginationResponse {
  int32 current_page = 1;
  int32 total_pages = 2;
  int32 total_records = 3;
}

// =============================================================================
// AUDIT LOGGING
// =============================================================================

message AuditLogEntry {
  string id = 1;
  string admin_id = 2;
  string action = 3;       // e.g., "DELETE_CHANNEL", "BAN_USER"
  string target_id = 4;    // The ID of the object being acted upon
  string target_type = 5;  // e.g., "USER", "FILE", "CHANNEL"
  string details = 6;      // JSON string or description
  string ip_address = 7;
  int64 created_at = 8;
}

message ListAuditLogsRequest {
  string admin_id = 1;     // Requester
  string filter_action = 2; // Optional: filter by "DELETE", etc.
  string filter_target = 3; // Optional: filter by target ID
  PaginationRequest pagination = 4;
}

message ListAuditLogsResponse {
  repeated AuditLogEntry logs = 1;
  PaginationResponse pagination = 2;
}

// =============================================================================
// DASHBOARD & ANALYTICS
// =============================================================================

message GetDashboardStatsRequest {
  string admin_id = 1;
}

message GetDashboardStatsResponse {
  // Numeric Stats (Use int64 for counters)
  int64 total_users_count = 1;
  int64 total_files_count = 2;
  int64 total_channels_count = 3;
  int64 total_storage_bytes = 4;

  // Recent Activity snapshots
  repeated DashboardUserPreview recent_users = 5;
  int64 active_users_24h = 6;
}

// =============================================================================
// ACCESS CHECKS
// =============================================================================

message CheckAdminStatusRequest {
  string user_id = 1;
}

message CheckAdminStatusResponse {
  bool is_admin = 1;
  repeated string permissions = 2; // e.g. ["VIEW_DASHBOARD", "BAN_USERS"]
}

// =============================================================================
// SERVICE DEFINITION
// =============================================================================

service AdminService {
  // Activity Monitoring & Compliance
  rpc ListAuditLogs(ListAuditLogsRequest) returns (ListAuditLogsResponse);

  // System Health & Overview
  rpc GetDashboardStats(GetDashboardStatsRequest) returns (GetDashboardStatsResponse);

  // Security Verification (Middleware helper)
  rpc CheckAdminStatus(CheckAdminStatusRequest) returns (CheckAdminStatusResponse);
}
