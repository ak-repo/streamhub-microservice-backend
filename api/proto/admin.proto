syntax = "proto3";

package admin;
option go_package = "./gen/adminpb";

// ---------------------------------------------------------------
// USER MODEL
// ---------------------------------------------------------------
message User {
  string id = 1;
  string email = 2;
  string username = 3;
  string role = 4;             
  bool email_verified = 5;
  string avatar_url = 6;
  bool is_banned = 7;
  string created_at = 8;
}

// ---------------------------------------------------------------
// FILE MODEL
// ---------------------------------------------------------------
message File {
  string id = 1;
  string owner_id = 2;
  string channel_id = 3;
  string filename = 4;
  int64 size = 5;
  string mime_type = 6;
  string storage_path = 7;
  bool is_public = 8;
  string created_at = 9;
  string owner_name = 10;
  string channel_name = 11;
}

// ---------------------------------------------------------------
// CHANNEL MODEL
// ---------------------------------------------------------------

message Channel {
  string id = 1;
  string name = 2;
  string description = 3;
  string created_by = 4;
  string owner_name = 5;
  bool is_frozen = 6;
  string created_at = 7;
  repeated MemberInfo members = 8;
}


message MemberInfo {
  string user_id = 1;
  string username = 2;
  string id = 3;
  string joined_at = 4;
}

message ListChannelsRequest {}
message ListChannelsResponse {
  repeated Channel channels = 1;
}

message GetChannelRequest {
  string channel_id = 1;
}
message GetChannelResponse {
  Channel channel = 1;
}

message FreezeChannelRequest {
  string channel_id = 1;
  string reason = 2;
}

message FreezeChannelResponse {
  bool success = 1;
}

message UnfreezeChannelRequest {
  string channel_id = 1;
}

message UnfreezeChannelResponse {
  bool success = 1;
}


message DeleteChannelRequest {
  string channel_id = 1;
  string admin_id = 2;

}
message DeleteChannelResponse {
  bool success = 1;
}

// ---------------------------------------------------------------
// USER GOVERNANCE
// ---------------------------------------------------------------
message BanUserRequest {
  string user_id = 1;
  string reason = 2;
}

message BanUserResponse {
  bool success = 1;
}

message UnbanUserRequest {
  string user_id = 1;
  string reason = 2;
}

message UnbanUserResponse {
  bool success = 1;
}

message UpdateRoleRequest {
  string user_id = 1;
  string role = 2; 
}

message UpdateRoleResponse {
  bool success = 1;
}

message ListUsersRequest {
  string filter_by = 1;
}

message ListUsersResponse {
  repeated User users = 1;
}



// ---------------------------------------------------------------
// FILE ADMINISTRATION
// ---------------------------------------------------------------
message AdminListAllFilesRequest {
  string admin_id = 1;
}

message AdminListAllFilesResponse {
  repeated File files = 1;
}

message AdminDeleteFileRequest {
  string file_id = 1;
  string admin_id = 2;
}

message AdminDeleteFileResponse {
  bool success = 1;
}

message AdminBlockUserUploadRequest {
  string user_id = 1;
  bool block = 2;
  string admin_id = 3;
}

message AdminBlockUserUploadResponse {
  bool success = 1;
}

message AdminStorageStatsRequest {
  string admin_id = 1;
}

message AdminStorageStatsResponse {
  int64 total_files = 1;
  int64 total_storage_bytes = 2;
  int64 public_files = 3;
  int64 private_files = 4;
}




// ---------------------------------------------------------------
// AUDIT LOGS
// ---------------------------------------------------------------
message GetAuditLogsRequest {
  int32 page = 1;
  int32 limit = 2;
}

message AuditLogEntry {
  string id = 1;
  string admin_id = 2;
  string action = 3;
  string target_id = 4;
  string details = 5;
  string created_at = 6;
}

message GetAuditLogsResponse {
  repeated AuditLogEntry logs = 1;
  int32 total_count = 2;
  int32 page = 3;
}


message IsAdminRequest {
  string admin_id = 1;
}

message IsAdminResponse{
  bool success = 1;
}

// ---------------------------------------------------------------
// ADMIN SERVICE
// ---------------------------------------------------------------
service AdminService {

  // User Governance
  rpc BanUser(BanUserRequest) returns (BanUserResponse);
  rpc UnbanUser(UnbanUserRequest) returns (UnbanUserResponse);
  rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse);
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);

  // Channel Management
  rpc ListChannels(ListChannelsRequest) returns (ListChannelsResponse);
  rpc GetChannel(GetChannelRequest) returns (GetChannelResponse);
  rpc FreezeChannel(FreezeChannelRequest) returns (FreezeChannelResponse);
  rpc UnfreezeChannel(UnfreezeChannelRequest) returns (UnfreezeChannelResponse);
  rpc DeleteChannel(DeleteChannelRequest) returns (DeleteChannelResponse);

  // Activity Monitoring
  rpc GetAuditLogs(GetAuditLogsRequest) returns (GetAuditLogsResponse);
  rpc IsAdmin(IsAdminRequest)returns (IsAdminResponse);

  // Files Management
  rpc AdminListAllFiles(AdminListAllFilesRequest) returns (AdminListAllFilesResponse);
  rpc AdminDeleteFile(AdminDeleteFileRequest) returns (AdminDeleteFileResponse);
  rpc AdminBlockUserUpload(AdminBlockUserUploadRequest) returns (AdminBlockUserUploadResponse);
  rpc AdminStorageStats(AdminStorageStatsRequest) returns (AdminStorageStatsResponse);
}
